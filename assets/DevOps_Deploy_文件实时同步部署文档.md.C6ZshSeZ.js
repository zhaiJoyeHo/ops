import{_ as s,c as i,o as a,a1 as n}from"./chunks/framework.CG9TfmPt.js";const E=JSON.parse('{"title":"rsync+inotify文件实时同步","description":"","frontmatter":{},"headers":[],"relativePath":"DevOps/Deploy/文件实时同步部署文档.md","filePath":"DevOps/Deploy/文件实时同步部署文档.md"}'),h={name:"DevOps/Deploy/文件实时同步部署文档.md"},l=n(`<h1 id="rsync-inotify文件实时同步" tabindex="-1">rsync+inotify文件实时同步 <a class="header-anchor" href="#rsync-inotify文件实时同步" aria-label="Permalink to &quot;rsync+inotify文件实时同步&quot;">​</a></h1><h2 id="一、前言" tabindex="-1">一、前言 <a class="header-anchor" href="#一、前言" aria-label="Permalink to &quot;一、前言&quot;">​</a></h2><blockquote><ul><li>rsync 是一个远程数据同步工具，可通过LAN/WAN快速同步多台主机间的文件。它使用所谓的“Rsync演算法”来使本地和远程两个主机之间的文件达到同步，这个算法只传送两个文件的不同部分，而不是每次都整份传送，因此速度相当快。但是rsync仅仅是同步工具，并不能做到监控文件变化并实时同步，因此还需要配合inotify来实现文件实时同步。</li><li>inotify 是一种强大的、细粒度的、异步的文件系统事件控制机制。linux内核从2.6.13起，加入了inotify支持，通过inotify可以监控文件系统中添加、删除、修改、移动等各种事件，利用这个内核接口，第三方软件就可以监控文件系统下文件的各种变化情况，而inotify-tools正是实施监控的软件。</li><li>使用inotify监控文件变化，同时通过脚本来触发rsync将发生变化的文件同步到目标服务器。</li></ul></blockquote><h2 id="二、术语定义" tabindex="-1">二、术语定义 <a class="header-anchor" href="#二、术语定义" aria-label="Permalink to &quot;二、术语定义&quot;">​</a></h2><blockquote><ul><li>客户端 — 源服务器 （SRC） 10.53.131.11</li><li>服务端 — 目标服务器（DEST）10.53.131.12</li></ul></blockquote><h2 id="三、安装配置rsync" tabindex="-1">三、安装配置rsync <a class="header-anchor" href="#三、安装配置rsync" aria-label="Permalink to &quot;三、安装配置rsync&quot;">​</a></h2><h3 id="_1-安装rsync服务" tabindex="-1">1. 安装rsync服务 <a class="header-anchor" href="#_1-安装rsync服务" aria-label="Permalink to &quot;1. 安装rsync服务&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsync</span></span></code></pre></div><h3 id="_2-关闭selinux" tabindex="-1">2. 关闭selinux <a class="header-anchor" href="#_2-关闭selinux" aria-label="Permalink to &quot;2. 关闭selinux&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#关闭selinux（服务端的selinux一定要关掉，不然rsync同步时会报错）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/selinux/config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SELINUX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">disabled</span></span></code></pre></div><h3 id="_3-编辑rsync配置文件-服务端" tabindex="-1">3. 编辑rsync配置文件（服务端） <a class="header-anchor" href="#_3-编辑rsync配置文件-服务端" aria-label="Permalink to &quot;3. 编辑rsync配置文件（服务端）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 特别注意：注释不能和内容在同一行，否则服务端报认证失败</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rsyncd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 此处的用户及用户组必须要拥有操作待同步文件的权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rsync默认监听端口873，也可以自定义</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 873</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chroot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connections</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/rsyncd.pid</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 排除同步文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exclude</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lost+found/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logging</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 900</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ignore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nonreadable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dont</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.tgz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.zip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.z</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.Z</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.deb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.bz2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[nginx_conf]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rsync服务端数据目录路径，即同步到目标目录后的存放路径，按需配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 此处定义模块名称，这个模块名称在rsync同步命令中需要调用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">comment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx_conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ignore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> errors</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> only</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置执行rsync同步的用户名，此用户名可自定义，不需与系统用户一致，需要与secrets file中设置的用户名匹配</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auth</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sync</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 用户认证配置文件，保存同步时使用的用户名密码，可设置多个用户名密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secrets</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/rsync_server.passwd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#允许进行同步的客户端地址，可设置多个，用英文逗号分隔</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hosts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.53.131.11</span></span></code></pre></div><h3 id="_4-编辑rsync用户认证配置文件" tabindex="-1">4. 编辑rsync用户认证配置文件 <a class="header-anchor" href="#_4-编辑rsync用户认证配置文件" aria-label="Permalink to &quot;4. 编辑rsync用户认证配置文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#服务端</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/rsync_server.passwd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sync:123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#客户端</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/rsync_client.passwd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#双向同步时两台服务器都需要配置这两个文件，sync:123456非实际存在的linux用户，只是客户端与服务端的约定</span></span></code></pre></div><h3 id="_5-修改配置文件权限" tabindex="-1">5. 修改配置文件权限 <a class="header-anchor" href="#_5-修改配置文件权限" aria-label="Permalink to &quot;5. 修改配置文件权限&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/rsync_client.passwd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/rsync_server.passwd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rsyncd.conf</span></span></code></pre></div><h3 id="_6-启动rsync服务" tabindex="-1">6. 启动rsync服务 <a class="header-anchor" href="#_6-启动rsync服务" aria-label="Permalink to &quot;6. 启动rsync服务&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsyncd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsyncd</span></span></code></pre></div><h3 id="_7-双向配置同步" tabindex="-1">7. 双向配置同步 <a class="header-anchor" href="#_7-双向配置同步" aria-label="Permalink to &quot;7. 双向配置同步&quot;">​</a></h3><ul><li>同步配置 <ul><li>单向同步只需在服务端启动rsyncd服务，客户端无需启动服务，可直接执行rsync命令</li><li>双向同步则需要在两台服务器启动rsyncd服务，两台服务器互为C--&gt;S</li></ul></li></ul><h2 id="四、安装配置inotify-tools" tabindex="-1">四、安装配置inotify-tools <a class="header-anchor" href="#四、安装配置inotify-tools" aria-label="Permalink to &quot;四、安装配置inotify-tools&quot;">​</a></h2><h3 id="_1-安装inotify-tools" tabindex="-1">1. 安装inotify-tools <a class="header-anchor" href="#_1-安装inotify-tools" aria-label="Permalink to &quot;1. 安装inotify-tools&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inotify-tools</span></span></code></pre></div><h3 id="_2-配置inotify-rsync同步脚本" tabindex="-1">2. 配置inotify_rsync同步脚本 <a class="header-anchor" href="#_2-配置inotify-rsync同步脚本" aria-label="Permalink to &quot;2. 配置inotify_rsync同步脚本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 客户端启动该脚本</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inotify_rsync.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 需要同步的源路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">src</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/nginx/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 目标服务器上rsyncd.conf中定义的名称(comment)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">des</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx_conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rsync验证的密码文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rsync_passwd_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/opt/rsync/rsync_client.passwd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 目标服务器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.53.131.12</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rsyncd.conf中定义的验证用户名(auth users)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sync</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定同步文件写入列表文件，列表文件路径必须用绝对路径，列表文件中内容用相对路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">include_list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/opt/rsync/include</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 同步日志输出到日志文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/opt/rsync/logs/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y-%m-%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${src}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inotifywait</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mrq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;%Xe %w%f&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> modify,create,delete,attrib,close_write,move</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> while</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> read</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 把inotify输出切割 把事件类型部分赋值给INO_EVENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        INO_EVENT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $1}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 把inotify输出切割 把文件路径部分赋值给INO_FILE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        INO_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $2}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-------------------------------$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)------------------------------------&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $file  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 增加、修改、写入完成、移动进事件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CREATE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;MODIFY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CLOSE_WRITE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;MOVED_TO&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CREATE or MODIFY or CLOSE_WRITE or MOVED_TO&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avrtzopgcRP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --include-from=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">include_list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --exclude=/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --password-file=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rsync_passwd_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${INO_FILE}) \${user}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${ip}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${des}  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fi</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 删除、移动出事件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;DELETE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;MOVED_FROM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;DELETE or MOVED_FROM&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avrtzopgcRP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --delete</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --include-from=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">include_list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --exclude=/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --password-file=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rsync_passwd_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${INO_FILE}) \${user}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${ip}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${des}  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fi</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 修改属性事件 指 touch chgrp chmod chown等操作</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $INO_EVENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ATTRIB&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ATTRIB&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 如果修改属性的是目录则不同步，因为同步目录会发生递归扫描，等此目录下的文件发生同步时，rsync会顺带更新此目录</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$INO_FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                then</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                        rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avrtzopgcRP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --include-from=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">include_list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --exclude=/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --password-file=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rsync_passwd_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${INO_FILE}) \${user}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${ip}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${des}  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                fi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fi</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -eq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;nginx reload success&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;nginx reload failed&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${log_path}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><h3 id="_3-编辑指定同步文件列表" tabindex="-1">3. 编辑指定同步文件列表 <a class="header-anchor" href="#_3-编辑指定同步文件列表" aria-label="Permalink to &quot;3. 编辑指定同步文件列表&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/include</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">conf.d/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssl/</span></span></code></pre></div><h3 id="_4-给同步脚本添加执行权限" tabindex="-1">4. 给同步脚本添加执行权限 <a class="header-anchor" href="#_4-给同步脚本添加执行权限" aria-label="Permalink to &quot;4. 给同步脚本添加执行权限&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inotify_rsync.sh</span></span></code></pre></div><h3 id="_5-创建启停脚本" tabindex="-1">5. 创建启停脚本 <a class="header-anchor" href="#_5-创建启停脚本" aria-label="Permalink to &quot;5. 创建启停脚本&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_start.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_rsync.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/nohup.out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inotify</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_start.sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_start.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_stop.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inotify</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $2}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xargs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kill</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_stop.sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rsync/inotify_stop.sh</span></span></code></pre></div><h3 id="_6-将同步脚本加到开机启动" tabindex="-1">6. 将同步脚本加到开机启动 <a class="header-anchor" href="#_6-将同步脚本加到开机启动" aria-label="Permalink to &quot;6. 将同步脚本加到开机启动&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;nohup /opt/rsync/inotify_rsync.sh &gt;/opt/rsync/nohup.out 2&gt;&amp;1 &amp;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rc.local</span></span></code></pre></div><h2 id="五、参数说明" tabindex="-1">五、参数说明 <a class="header-anchor" href="#五、参数说明" aria-label="Permalink to &quot;五、参数说明&quot;">​</a></h2><h3 id="_1-rsync参数说明" tabindex="-1">1. rsync参数说明 <a class="header-anchor" href="#_1-rsync参数说明" aria-label="Permalink to &quot;1. rsync参数说明&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-v,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 详细模式输出</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-q,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --quiet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 精简输出模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-c,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --checksum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 打开校验开关，强制对文件传输进行校验</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-a,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --archive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-r,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --recursive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 对子目录以递归模式处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-R,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --relative</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 使用相对路径信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-b,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 创建备份，也就是对于目的已经存在有同样的文件名时，将老的文件重新命名为~filename。可以使用--suffix选项来指定不同的备份文件前缀。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--backup-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 将备份文件</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">如~filename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">存放在在目录下。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-suffix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SUFFIX</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 定义备份文件前缀</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-u,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件。</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">不覆盖更新的文件</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-l,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --links</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保留软链结</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-L,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --copy-links</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 想对待常规文件一样处理软链结</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--copy-unsafe-links</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 仅仅拷贝指向SRC路径目录树以外的链结</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--safe-links</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 忽略指向SRC路径目录树以外的链结</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-H,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard-links</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保留硬链结</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-p,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --perms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保持文件权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-o,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --owner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保持文件属主信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-g,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保持文件属组信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-D,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --devices</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保持设备文件信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-t,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --times</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保持文件时间信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-S,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sparse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 对稀疏文件进行特殊处理以节省DST的空间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-n,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dry-run现实哪些文件将被传输</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-W,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --whole-file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 拷贝文件，不进行增量检测</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-x,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --one-file-system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 不要跨越文件系统边界</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-B,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --block-size=SIZE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 检验算法使用的块尺寸，默认是700字节</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-e,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rsh=COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 指定使用rsh、ssh方式进行数据同步</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--rsync-path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PATH</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 指定远程服务器上的rsync命令所在路径信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-C,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cvs-exclude</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 使用和CVS一样的方法自动忽略文件，用来排除那些不希望传输的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--existing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 仅仅更新那些已经存在于DST的文件，而不备份那些新创建的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 删除那些DST中SRC没有的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--delete-excluded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 同样删除接收端那些被该选项指定排除的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--delete-after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 传输结束以后再删除</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--ignore-errors</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 及时出现IO错误也进行删除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--max-delete</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NUM</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 最多删除NUM个文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--partial</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 保留那些因故没有完全传输的文件，以是加快随后的再次传输</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--force</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 强制删除目录，即使不为空</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--numeric-ids</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 不将数字的用户和组ID匹配为用户名和组名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--timeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TIME</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IP超时时间，单位为秒</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-I,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --ignore-times</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 不跳过那些有同样的时间和长度的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--size-only</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 当决定是否要备份文件时，仅仅察看文件大小而不考虑文件时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--modify-window</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NUM</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 决定文件是否时间相同时使用的时间戳窗口，默认为0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-T</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --temp-dir=DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 在DIR中创建临时文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--compare-dest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DIR</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 同样比较DIR中的文件来决定是否需要备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-P</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 等同于</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --partial</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--progress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 显示备份过程</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-z,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --compress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 对备份的文件在传输时进行压缩处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--exclude</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PATTERN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 指定排除不需要传输的文件模式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--include</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PATTERN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 指定不排除而需要传输的文件模式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--exclude-from</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FILE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 排除FILE中指定模式的文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--include-from</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FILE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 不排除FILE指定模式匹配的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 打印版本信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 绑定到特定的地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FILE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 指定其他的配置文件，不使用默认的rsyncd.conf文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PORT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 指定其他的rsync服务端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--blocking-io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 对远程shell使用阻塞IO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-stats</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 给出某些文件的传输状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--progress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 在传输时现实传输过程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--log-format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">formAT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 指定日志文件格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--password-file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FILE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 从FILE中得到密码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--bwlimit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">KBPS</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 限制I/O带宽，KBytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> per</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> second</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-h,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --help</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 显示帮助信息</span></span></code></pre></div><h3 id="_2-inotifywait参数说明" tabindex="-1">2. inotifywait参数说明 <a class="header-anchor" href="#_2-inotifywait参数说明" aria-label="Permalink to &quot;2. inotifywait参数说明&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-h,–help</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 输出帮助信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-m,–monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	始终保持事件监听状态，接收到一个事件而不退出，无限期地执行。默认的行为是接收到一个事件后立即退出</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-r,–recursive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 递归查询目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-q,–quiet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	只打印监控事件的信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">–exclude</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	正则匹配需要排除的文件，区分大小写</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">–excludei</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	正则匹配需要排除的文件，不区分大小写</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-t,–timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	超时时间，如果为0，则无限期地执行下去</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">–timefmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	指定时间输出格式，用于–format选项中的%T格式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">–format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	指定输出格式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	%w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 表示发生事件的目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	%f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 表示发生事件的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	%e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 表示发生的事件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	%Xe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 事件以“X”分隔</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	%T</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 使用由–timefmt定义的时间格式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-e,–event</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 指定监视的事件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">–fromfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 从文件读取需要监视的文件或排除的文件，一个文件一行，排除的文件以@开头</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-d,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> –daemon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 跟–monitor一样，除了是在后台运行，需要指定–outfile把事情输出到一个文件。也意味着使用了–syslog。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-o,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> –outfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  输出事情到一个文件而不是标准输出。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-s,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> –syslog</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 输出错误信息到系统日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-c,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> –csv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 输出csv格式</span></span></code></pre></div><h3 id="_3-inotifywait-events事件说明" tabindex="-1">3. inotifywait events事件说明 <a class="header-anchor" href="#_3-inotifywait-events事件说明" aria-label="Permalink to &quot;3. inotifywait events事件说明&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">access</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	读取文件或目录内容</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	修改文件或目录内容</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attrib</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件或目录属性更改，如权限，时间戳等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close_write</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	以可写模式打开的文件被关闭，不代表此文件一定已经写入数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close_nowrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	以只读模式打开的文件被关闭</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件被关闭，不管它是如何打开的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件打开</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">moved_to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	一个文件或目录移动到监听的目录，即使是在同一目录内移动，此事件也触发</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">moved_from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	一个文件或目录移出监听的目录，即使是在同一目录内移动，此事件也触发</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">move</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	包括moved_to和</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> moved_from</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">move_self</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件或目录被移除，之后不再监听此文件或目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件或目录创建</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件或目录删除</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete_self</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件或目录移除，之后不再监听此文件或目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unmount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	文件系统取消挂载，之后不再监听此文件系统</span></span></code></pre></div>`,40),k=[l];function p(t,e,F,r,d,y){return a(),i("div",null,k)}const c=s(h,[["render",p]]);export{E as __pageData,c as default};
