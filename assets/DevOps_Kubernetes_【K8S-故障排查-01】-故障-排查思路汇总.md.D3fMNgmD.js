import{_ as s,c as a,o as i,a1 as e}from"./chunks/framework.CG9TfmPt.js";const u=JSON.parse('{"title":"K8S-故障-排查思路汇总","description":"","frontmatter":{},"headers":[],"relativePath":"DevOps/Kubernetes/【K8S-故障排查-01】-故障-排查思路汇总.md","filePath":"DevOps/Kubernetes/【K8S-故障排查-01】-故障-排查思路汇总.md"}'),t={name:"DevOps/Kubernetes/【K8S-故障排查-01】-故障-排查思路汇总.md"},l=e(`<h1 id="k8s-故障-排查思路汇总" tabindex="-1">K8S-故障-排查思路汇总 <a class="header-anchor" href="#k8s-故障-排查思路汇总" aria-label="Permalink to &quot;K8S-故障-排查思路汇总&quot;">​</a></h1><h2 id="一、应用程序故障排查" tabindex="-1">一、应用程序故障排查 <a class="header-anchor" href="#一、应用程序故障排查" aria-label="Permalink to &quot;一、应用程序故障排查&quot;">​</a></h2><h3 id="_1、非running状态时-查看pod事件进行问题排查" tabindex="-1">1、非Running状态时，查看Pod事件进行问题排查 <a class="header-anchor" href="#_1、非running状态时-查看pod事件进行问题排查" aria-label="Permalink to &quot;1、非Running状态时，查看Pod事件进行问题排查&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span></code></pre></div><h3 id="_2、查看pod中容器日志" tabindex="-1">2、查看Pod中容器日志 <a class="header-anchor" href="#_2、查看pod中容器日志" aria-label="Permalink to &quot;2、查看Pod中容器日志&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tail=100</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xx</span></span></code></pre></div><h3 id="_3、进入容器执行命令" tabindex="-1">3、进入容器执行命令 <a class="header-anchor" href="#_3、进入容器执行命令" aria-label="Permalink to &quot;3、进入容器执行命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> args</span></span></code></pre></div><h3 id="_4、pod处于pending状态可能原因-无法被正常调度到工作节点" tabindex="-1">4、Pod处于pending状态可能原因，无法被正常调度到工作节点 <a class="header-anchor" href="#_4、pod处于pending状态可能原因-无法被正常调度到工作节点" aria-label="Permalink to &quot;4、Pod处于pending状态可能原因，无法被正常调度到工作节点&quot;">​</a></h3><ul><li>下载镜像</li><li>Node节点资源不足</li><li>没有匹配到节点标签</li><li>存在污点</li></ul><h3 id="_5、pod处于waiting状态可能原因-已被调度到工作节点但无法在该节点运行" tabindex="-1">5、Pod处于waiting状态可能原因，已被调度到工作节点但无法在该节点运行 <a class="header-anchor" href="#_5、pod处于waiting状态可能原因-已被调度到工作节点但无法在该节点运行" aria-label="Permalink to &quot;5、Pod处于waiting状态可能原因，已被调度到工作节点但无法在该节点运行&quot;">​</a></h3><ul><li>镜像名称</li><li>镜像是否已推送到仓库</li><li>手动在节点上运行<em><strong>docker pull</strong></em></li></ul><h2 id="二、管理节点异常排查" tabindex="-1">二、管理节点异常排查 <a class="header-anchor" href="#二、管理节点异常排查" aria-label="Permalink to &quot;二、管理节点异常排查&quot;">​</a></h2><ul><li>kubeadm部署，除kubelet服务外，其他组件均采用静态Pod启动</li><li>/etc/kubernetes/manifests</li><li>/var/lib/kubelet/config.yaml (staticPodPath) -- 修改静态pod配置文件路径</li></ul><h2 id="三、工作节点异常排查" tabindex="-1">三、工作节点异常排查 <a class="header-anchor" href="#三、工作节点异常排查" aria-label="Permalink to &quot;三、工作节点异常排查&quot;">​</a></h2><ul><li>**kubelet：**调用容器引擎接口管理容器，并将容器运行状态上报给<em>apiserver</em></li><li>**kube-proxy：**实现Pod的负载均衡和服务发现，根据访问请求转发到后面的一组<em>Pod</em></li></ul><h3 id="_1、node-notready可能原因" tabindex="-1">1、Node NotReady可能原因 <a class="header-anchor" href="#_1、node-notready可能原因" aria-label="Permalink to &quot;1、Node NotReady可能原因&quot;">​</a></h3><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;1&gt; kubelet服务启动有问题</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;2&gt; kubelet与apiserver网络不通</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;3&gt; kubelet携带证书有问题，例如过期</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;4&gt; node节点磁盘空间已满</span></span></code></pre></div><h2 id="四、service访问异常排查" tabindex="-1">四、Service访问异常排查 <a class="header-anchor" href="#四、service访问异常排查" aria-label="Permalink to &quot;四、Service访问异常排查&quot;">​</a></h2><p>client &gt; kube-proxy监听一个端口，接受流量会被iptables/ipvs处理 &gt; 一组pod（分散每个节点）</p><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;1&gt; kubectl get pod / kubectl get svc -- 查看pod和svc运行是否正常</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;2&gt; kubectl get ep -- 查看service是否正常关联到pod</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;3&gt; kubectl exec -it web -- netstat -lntp service指定的targetport是否正确</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;4&gt; Service是否通过DNS工作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;5&gt; kube-proxy正常工作吗</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;6&gt; kube-proxy是否正常写iptables规则</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;7&gt; cni网络插件是否正常工作</span></span></code></pre></div>`,21),n=[l];function h(p,d,k,r,o,c){return i(),a("div",null,n)}const b=s(t,[["render",h]]);export{u as __pageData,b as default};
