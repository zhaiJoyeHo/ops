<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>fluentd-k8s部署文档 | LTSK-运维知识库</title>
    <meta name="description" content="关注运维技术">
    <meta name="generator" content="VitePress v1.2.3">
    <link rel="preload stylesheet" href="/ops/assets/style.BqpOtm2H.css" as="style">
    
    <script type="module" src="/ops/assets/app.qQ5_3PyI.js"></script>
    <link rel="preload" href="/ops/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/ops/assets/chunks/framework.CG9TfmPt.js">
    <link rel="modulepreload" href="/ops/assets/chunks/theme.DFosOuHg.js">
    <link rel="modulepreload" href="/ops/assets/DevOps_Deploy_fluentd-k8s部署文档.md.BJUNZt2p.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/ops/" data-v-ab179fa1><!--[--><!--]--><!----><span data-v-ab179fa1>LTSK-运维知识库</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ops/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ops/DevOps/Kubernetes/index.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Kubernetes</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ops/DevOps/Linux/index.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Linux</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ops/DevOps/Deploy/index.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>部署</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ops/DevOps/MySQL/index.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>数据库</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ops/DevOps/Network/index.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>网络</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-b8d55f3b><!----><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/%E4%BA%91%E9%93%BE%E9%80%9A%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>0. 云链通配置信息</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/RocketMQ%205.2.0%20%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>1. RocketMQ-V5.2.0-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/Minio%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>2. Minio-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/Seata%20v2.1.0%20%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>3. Seata-V2.1.0-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/%E5%8F%91%E5%B8%83%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>4. ylt发布平台-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/%E6%96%87%E4%BB%B6%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>5. rsync+inotify-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/Mysql%208.4.2%20%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>6. MySQL8.4.2-主从-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/fluentd-k8s%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>7. fluentd-k8s-部署文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/ops/DevOps/Deploy/kibana-%E8%AE%BE%E7%BD%AEes%E7%B4%A2%E5%BC%95%E8%BF%87%E6%9C%9F.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>8. kibana-设置es索引过期</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _ops_DevOps_Deploy_fluentd-k8s%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3" data-v-39a288b8><div><h1 id="fluentd-k8s部署文档" tabindex="-1">fluentd-k8s部署文档 <a class="header-anchor" href="#fluentd-k8s部署文档" aria-label="Permalink to &quot;fluentd-k8s部署文档&quot;">​</a></h1><h2 id="一、前言" tabindex="-1">一、前言 <a class="header-anchor" href="#一、前言" aria-label="Permalink to &quot;一、前言&quot;">​</a></h2><blockquote><ul><li>使用fluentd官方提供的kubernetes部署方案daemonset来部署日志收集。</li><li><a href="https://github.com/fluent/fluentd-kubernetes-daemonset" target="_blank" rel="noreferrer">https://github.com/fluent/fluentd-kubernetes-daemonset</a></li><li>v1.16.5</li></ul></blockquote><h2 id="二、部署" tabindex="-1">二、部署 <a class="header-anchor" href="#二、部署" aria-label="Permalink to &quot;二、部署&quot;">​</a></h2><h3 id="_1-创建命名空间" tabindex="-1">1. 创建命名空间 <a class="header-anchor" href="#_1-创建命名空间" aria-label="Permalink to &quot;1. 创建命名空间&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log-fluentd</span></span></code></pre></div><h3 id="_2-编辑daemonset-yaml文件" tabindex="-1">2. 编辑daemonset-yaml文件 <a class="header-anchor" href="#_2-编辑daemonset-yaml文件" aria-label="Permalink to &quot;2. 编辑daemonset-yaml文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下载 fluentd-daemonset-elasticsearch-rbac.yaml重命名fluentd-containerd-daemonset-elasticsearch-rbac.yaml进行编辑</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ServiceAccount</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log-fluentd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ClusterRole</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rules:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apiGroups:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespaces</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  verbs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> watch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ClusterRoleBinding</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">roleRef:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ClusterRole</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  apiGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rbac.authorization.k8s.io</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subjects:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ServiceAccount</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log-fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DaemonSet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log-fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    k8s-app:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-logging</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    version:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      k8s-app:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-logging</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      version:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  template:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        k8s-app:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-logging</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        version:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      imagePullSecrets:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> harborsecret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      serviceAccount:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      serviceAccountName:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      nodeSelector:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        beta.kubernetes.io/fluentd-ds-ready:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      tolerations:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-role.kubernetes.io/control-plane</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        effect:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NoSchedule</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-role.kubernetes.io/master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        effect:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NoSchedule</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      containers:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        image:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.53.142.13/devops/fluentd-kubernetes-daemonset:v1-debian-elasticsearch-gmt8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        imagePullPolicy:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IfNotPresent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        env:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> K8S_NODE_NAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            valueFrom:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              fieldRef:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                fieldPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> spec.nodeName</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  FLUENT_ELASTICSEARCH_HOST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;10.53.152.16&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  FLUENT_ELASTICSEARCH_PORT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;9200&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_ELASTICSEARCH_SCHEME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # Option to configure elasticsearch plugin with self signed certs</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # ================================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_ELASTICSEARCH_SSL_VERIFY</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;false&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # Option to configure elasticsearch plugin with tls</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # ================================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_ELASTICSEARCH_SSL_VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;TLSv1_2&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # X-Pack Authentication</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # =====================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #- name: FLUENT_ELASTICSEARCH_USER</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #  value: &quot;elastic&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #- name: FLUENT_ELASTICSEARCH_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #  value: &quot;yltEs@2024&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENTD_SYSTEMD_CONF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;disable&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENTD_PROMETHEUS_CONF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;disable&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_ELASTICSEARCH_LOGSTASH_DATEFORMAT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%Y.%m&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_CONTAINER_TAIL_PATH</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/log/containers/ltd-*.log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_ELASTICSEARCH_LOGSTASH_PREFIX</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;k8s_uat&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLUENT_ELASTICSEARCH_LOGSTASH_INDEX_NAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            value:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;k8s_uat&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          limits:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1024Mi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          requests:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 100m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 200Mi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        terminationMessagePath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/termination-log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        terminationMessagePolicy:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> File</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        volumeMounts:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> varlog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # When actual pod logs in /var/lib/docker/containers, the following lines should be used.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # - name: dockercontainerlogdirectory</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #   mountPath: /var/lib/docker/containers</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #   readOnly: true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # When actual pod logs in /var/log/pods, the following lines should be used.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockercontainerlogdirectory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          readOnly:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerdirectory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          readOnly:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/filterlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filterlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/recordmodify.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> recordmodify.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/concatlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> concatlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/parselog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parselog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/elasticsearch.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/conf.d/custom.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/kubernetes.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mountPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fluentd/etc/fluent.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          subPath:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluent.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      terminationGracePeriodSeconds:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      volumes:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> varlog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        hostPath:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          path:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # When actual pod logs in /var/lib/docker/containers, the following lines should be used.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # - name: dockercontainerlogdirectory</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #   hostPath:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #     path: /var/lib/docker/containers</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # When actual pod logs in /var/log/pods, the following lines should be used.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockercontainerlogdirectory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        hostPath:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          path:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerdirectory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        hostPath:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          path:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        configMap:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-config-containerd</span></span></code></pre></div><h3 id="_3-编辑configmap-yaml文件" tabindex="-1">3. 编辑configmap-yaml文件 <a class="header-anchor" href="#_3-编辑configmap-yaml文件" aria-label="Permalink to &quot;3. 编辑configmap-yaml文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#编辑fluentd-config-containerd.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stack:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-config-containerd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log-fluentd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  concatlog.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> concat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      stream_identity_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container_id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      multiline_start_regexp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flush_interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      timeout_label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @TIMEOUT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @TIMEOU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parselog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch.conf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  custom.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../filterlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../recordmodify.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../concatlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../parselog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  elasticsearch.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @log_level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      include_tag_key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_HOST&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PORT&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PATH&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SCHEME&#39;] || &#39;http&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ssl_verify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SSL_VERIFY&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ssl_version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SSL_VERSION&#39;] || &#39;TLSv1_2&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_USER&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PASSWORD&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      reload_connections</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RELOAD_CONNECTIONS&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      reconnect_on_error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RECONNECT_ON_ERROR&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      reload_on_failure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RELOAD_ON_FAILURE&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      log_es_400_reason</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOG_ES_400_REASON&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      logstash_prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_PREFIX&#39;] || &#39;logstash&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      logstash_dateformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_DATEFORMAT&#39;] || &#39;%Y.%m.%d&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      logstash_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_FORMAT&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      index_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_INDEX_NAME&#39;] || &#39;logstash&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      target_index_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TARGET_INDEX_KEY&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      type_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_TYPE_NAME&#39;] || &#39;fluentd&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      include_timestamp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_INCLUDE_TIMESTAMP&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      template_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_NAME&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      template_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_FILE&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      template_overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_OVERWRITE&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      sniffer_class_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_SNIFFER_CLASS_NAME&#39;] || &#39;Fluent::Plugin::ElasticsearchSimpleSniffer&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      request_timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_REQUEST_TIMEOUT&#39;] || &#39;5s&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      application_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_APPLICATION_NAME&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      suppress_type_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SUPPRESS_TYPE_NAME&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      enable_ilm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ENABLE_ILM&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ilm_policy_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY_ID&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ilm_policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ilm_policy_overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY_OVERWRITE&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      time_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      time_key_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%Y-%m-%d %H:%M:%S.%N&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      utc_index</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        flush_thread_count</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_THREAD_COUNT&#39;] || &#39;8&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        flush_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_INTERVAL&#39;] || &#39;5s&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        chunk_limit_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_CHUNK_LIMIT_SIZE&#39;] || &#39;16M&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        queue_limit_length</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_QUEUE_LIMIT_LENGTH&#39;] || &#39;32&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        retry_max_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_RETRY_MAX_INTERVAL&#39;] || &#39;30&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        retry_forever</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  filterlog.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}T</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\+\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  parselog.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      key_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      reserve_data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multiline</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        format_firstline</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        format1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logtime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4}-\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{2}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{2}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">\s+\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{2}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{2}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{2}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">\.\d+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SERVER_NAME:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\]\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REQUEST_ID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">traceid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\]\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+---</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s\[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\[\]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\]\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s\S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  recordmodify.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> record_modifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        appname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;container_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        deploymenthost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;host&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        environment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        environment_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;namespace_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      remove_keys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes,docker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  kubernetes.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @FLUENT_LO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluent.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ignore_fluent_logs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in_tail_container_logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_PATH&#39;] || &#39;/var/log/containers/*.log&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      pos_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{File.join(&#39;/var/log/&#39;, ENV.fetch(&#39;FLUENT_POS_EXTRA_DIR&#39;, &#39;&#39;), &#39;fluentd-containers.log.pos&#39;)}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_TAG&#39;] || &#39;kubernetes.*&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      exclude_path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_EXCLUDE_PATH&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      read_from_head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;regexp&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        time_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_PARSER_TIME_FORMAT&#39;] || &#39;%Y-%m-%dT%H:%M:%S.%NZ&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        expression</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\-\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\-\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+T</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\+\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">raw_log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s\S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes_metadata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter_kube_metadata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      kubernetes_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_FILTER_KUBERNETES_URL&#39;] || &#39;https://&#39; + ENV.fetch(&#39;KUBERNETES_SERVICE_HOST&#39;) + &#39;:&#39; + ENV.fetch(&#39;KUBERNETES_SERVICE_PORT&#39;) + &#39;/api&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      verify_ssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;KUBERNETES_VERIFY_SSL&#39;] || true}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ca_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;KUBERNETES_CA_FILE&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      skip_labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_LABELS&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      skip_container_metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_CONTAINER_METADATA&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      skip_master_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_MASTER_URL&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      skip_namespace_metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_NAMESPACE_METADATA&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      watch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_WATCH&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fluent.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENTD_SYSTEMD_CONF&#39;] || &#39;systemd&#39;}.conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENTD_PROMETHEUS_CONF&#39;] || &#39;prometheus&#39;}.conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conf.d/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out_es</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       @log_level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       include_tag_key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_HOST&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PORT&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PATH&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SCHEME&#39;] || &#39;http&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ssl_verify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SSL_VERIFY&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ssl_version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SSL_VERSION&#39;] || &#39;TLSv1_2&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_USER&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PASSWORD&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       reload_connections</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RELOAD_CONNECTIONS&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       reconnect_on_error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RECONNECT_ON_ERROR&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       reload_on_failure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RELOAD_ON_FAILURE&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       log_es_400_reason</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOG_ES_400_REASON&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       logstash_prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_PREFIX&#39;] || &#39;test&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       logstash_dateformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_DATEFORMAT&#39;] || &#39;%Y.%m.%d&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       logstash_format</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       index_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_INDEX_NAME&#39;] || &#39;test&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       target_index_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TARGET_INDEX_KEY&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       type_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_TYPE_NAME&#39;] || &#39;fluentd&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       include_timestamp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_INCLUDE_TIMESTAMP&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       template_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_NAME&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       template_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_FILE&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       template_overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_OVERWRITE&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       sniffer_class_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_SNIFFER_CLASS_NAME&#39;] || &#39;Fluent::Plugin::ElasticsearchSimpleSniffer&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       request_timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_REQUEST_TIMEOUT&#39;] || &#39;5s&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       application_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_APPLICATION_NAME&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       suppress_type_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SUPPRESS_TYPE_NAME&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       enable_ilm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ENABLE_ILM&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ilm_policy_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY_ID&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ilm_policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ilm_policy_overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY_OVERWRITE&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       time_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       time_key_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%Y-%m-%d %H:%M:%S.%N&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       utc_index</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         flush_thread_count</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_THREAD_COUNT&#39;] || &#39;8&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         flush_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_INTERVAL&#39;] || &#39;5s&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         chunk_limit_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_CHUNK_LIMIT_SIZE&#39;] || &#39;2M&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         queue_limit_length</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_QUEUE_LIMIT_LENGTH&#39;] || &#39;32&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         retry_max_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_RETRY_MAX_INTERVAL&#39;] || &#39;30&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         retry_forever</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="_4-执行yaml" tabindex="-1">4. 执行yaml <a class="header-anchor" href="#_4-执行yaml" aria-label="Permalink to &quot;4. 执行yaml&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-config-containerd.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluentd-containerd-daemonset-elasticsearch-rbac.yaml</span></span></code></pre></div><h2 id="三、采集异常排查" tabindex="-1">三、采集异常排查 <a class="header-anchor" href="#三、采集异常排查" aria-label="Permalink to &quot;三、采集异常排查&quot;">​</a></h2><h3 id="_1-异常描述" tabindex="-1">1. 异常描述 <a class="header-anchor" href="#_1-异常描述" aria-label="Permalink to &quot;1. 异常描述&quot;">​</a></h3><ul><li>部署并配置fluentd服务后，在elasticsearch和kibana上看不到日志。</li></ul><h3 id="_2-梳理配置日志采集流程" tabindex="-1">2. 梳理配置日志采集流程 <a class="header-anchor" href="#_2-梳理配置日志采集流程" aria-label="Permalink to &quot;2. 梳理配置日志采集流程&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#容器内路径 /fluentd/etc/fluent.conf,调用如下</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/fluentd/etc/fluent.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    /fluentd/etc/kubernetes.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        /fluentd/etc/tail_container_parse.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    /fluentd/etc/conf.d/custom.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        /fluentd/etc/filterlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        /fluentd/etc/recordmodify.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        /fluentd/etc/concatlog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        /fluentd/etc/parselog.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#采集流程 开始 -&gt; 原始日志输入 -&gt; 日志过滤 -&gt; 日志增加字段 -&gt; 多行日志合并 -&gt; 解析日志 -&gt; 投递es -&gt; 结束</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">分支</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 超时任务处理</span></span></code></pre></div><h3 id="_3-查看fluentd实例输出日志" tabindex="-1">3. 查看fluentd实例输出日志 <a class="header-anchor" href="#_3-查看fluentd实例输出日志" aria-label="Permalink to &quot;3. 查看fluentd实例输出日志&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志中有in_tail_container_logs，说明是在原始日志输入阶段出错</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看对应的配置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in_tail_container_logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/log/containers/ltd-*.log&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # tail文件路径和模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pos_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/log/fluentd-containers.log.pos&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 记录tail位置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;kubernetes.*&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 打标签，便于后续的处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  exclude_path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  read_from_head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;json&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 使用json模式解析日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    time_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%Y-%m-%dT%H:%M:%S.%NZ&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    unmatched_lines</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    time_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> string</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># fluentd会tail /var/log/containers 路径下模式为 ltd-*.log文件，并记录position。之后会解析日志，解析类型为json。日志报错内容&quot;pattern not matched&quot;可能就是因它而起。</span></span></code></pre></div><h3 id="_4-手动验证上述分析" tabindex="-1">4. 手动验证上述分析 <a class="header-anchor" href="#_4-手动验证上述分析" aria-label="Permalink to &quot;4. 手动验证上述分析&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入到fluentd pod中，手动编写简单的配置文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in_tail_container_logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/log/containers/ltd-*.log&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # tail文件路径和模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pos_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/log/fluentd-containers.log.pos&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 记录tail位置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;kubernetes.*&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 打标签，便于后续的处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  exclude_path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  read_from_head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;json&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 使用json模式解析日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    time_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%Y-%m-%dT%H:%M:%S.%NZ&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    unmatched_lines</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    time_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> string</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">match </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stdout</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/match</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fluentd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./test.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 通过控制台打印的日志，验证推断，问题就是出在日志输入阶段</span></span></code></pre></div><h3 id="_5-查看节点上容器日志格式" tabindex="-1">5. 查看节点上容器日志格式 <a class="header-anchor" href="#_5-查看节点上容器日志格式" aria-label="Permalink to &quot;5. 查看节点上容器日志格式&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看/var/log/containers目录下日志输出，发现为文本格式，其中红框内容为运行时添加时间戳 + 输出类型(stdout&amp;stderr) + F：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2024-11-17T22:13:21.928285618+08:00 stdout F</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 因containerd做为运行时的日志输出与docker输出不一致，使用在docker作为容器运行时的日志采集配置，会导致异常</span></span></code></pre></div><h2 id="四、异常处理" tabindex="-1">四、异常处理 <a class="header-anchor" href="#四、异常处理" aria-label="Permalink to &quot;四、异常处理&quot;">​</a></h2><h3 id="_1-修改kubernetes-conf配置" tabindex="-1">1. 修改kubernetes.conf配置 <a class="header-anchor" href="#_1-修改kubernetes-conf配置" aria-label="Permalink to &quot;1. 修改kubernetes.conf配置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">label @FLUENT_LOG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fluent.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ignore_fluent_logs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in_tail_container_logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_PATH&#39;] || &#39;/var/log/containers/*.log&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pos_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{File.join(&#39;/var/log/&#39;, ENV.fetch(&#39;FLUENT_POS_EXTRA_DIR&#39;, &#39;&#39;), &#39;fluentd-containers.log.pos&#39;)}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_TAG&#39;] || &#39;kubernetes.*&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  exclude_path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_EXCLUDE_PATH&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  read_from_head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输入配置中，parse器的类型选择为regexp，通过正则表达式过滤掉容器运行时增加的日志内容，将应用打印的日志正文命名为raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;regexp&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    time_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_CONTAINER_TAIL_PARSER_TIME_FORMAT&#39;] || &#39;%Y-%m-%dT%H:%M:%S.%NZ&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expression</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\-\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\-\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+T</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\+\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">raw_log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s\S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filter kubernetes.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes_metadata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter_kube_metadata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  kubernetes_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_FILTER_KUBERNETES_URL&#39;] || &#39;https://&#39; + ENV.fetch(&#39;KUBERNETES_SERVICE_HOST&#39;) + &#39;:&#39; + ENV.fetch(&#39;KUBERNETES_SERVICE_PORT&#39;) + &#39;/api&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  verify_ssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;KUBERNETES_VERIFY_SSL&#39;] || true}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ca_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;KUBERNETES_CA_FILE&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  skip_labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_LABELS&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  skip_container_metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_CONTAINER_METADATA&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  skip_master_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_MASTER_URL&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  skip_namespace_metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_METADATA_SKIP_NAMESPACE_METADATA&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  watch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_KUBERNETES_WATCH&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/filter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="_2-修改filterlog-conf配置" tabindex="-1">2. 修改filterlog.conf配置 <a class="header-anchor" href="#_2-修改filterlog-conf配置" aria-label="Permalink to &quot;2. 修改filterlog.conf配置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filterlog.conf:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 过滤“空行”</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key修改为raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}T</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\+\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="_3-修改recordmodify-conf配置" tabindex="-1">3. 修改recordmodify.conf配置 <a class="header-anchor" href="#_3-修改recordmodify-conf配置" aria-label="Permalink to &quot;3. 修改recordmodify.conf配置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filter kubernetes.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> record_modifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    appname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;container_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploymenthost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;host&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    environment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    environment_type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;namespace_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  remove_keys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes,docker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/filter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="_4-修改concatlog-conf配置" tabindex="-1">4. 修改concatlog.conf配置 <a class="header-anchor" href="#_4-修改concatlog-conf配置" aria-label="Permalink to &quot;4. 修改concatlog.conf配置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filter kubernetes.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> concat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key修改为raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  stream_identity_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container_id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  multiline_start_regexp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  flush_interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  timeout_label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @TIMEOUT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/filter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">label @TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parselog.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch.conf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="_5-修改parselog-conf配置" tabindex="-1">5. 修改parselog.conf配置 <a class="header-anchor" href="#_5-修改parselog-conf配置" aria-label="Permalink to &quot;5. 修改parselog.conf配置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filter kubernetes.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  key_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key修改为raw_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reserve_data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multiline</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    format_firstline</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    format1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logtime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4}-\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{2}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{2}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">\s+\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{2}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{2}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{2}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">\.\d+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SERVER_NAME:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\[</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REQUEST_ID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">traceid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\]\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+---</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s\[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\[\]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\]\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s\S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/filter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="_6-保持-elasticsearch-conf配置不变" tabindex="-1">6. 保持 elasticsearch.conf配置不变 <a class="header-anchor" href="#_6-保持-elasticsearch-conf配置不变" aria-label="Permalink to &quot;6. 保持 elasticsearch.conf配置不变&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">match kubernetes.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @log_level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  include_tag_key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_HOST&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PORT&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PATH&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SCHEME&#39;] || &#39;http&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ssl_verify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SSL_VERIFY&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ssl_version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SSL_VERSION&#39;] || &#39;TLSv1_2&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_USER&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_PASSWORD&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reload_connections</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RELOAD_CONNECTIONS&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reconnect_on_error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RECONNECT_ON_ERROR&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reload_on_failure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_RELOAD_ON_FAILURE&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  log_es_400_reason</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOG_ES_400_REASON&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  logstash_prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_PREFIX&#39;] || &#39;logstash&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  logstash_dateformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_DATEFORMAT&#39;] || &#39;%Y.%m.%d&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  logstash_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_FORMAT&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  index_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_INDEX_NAME&#39;] || &#39;logstash&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  target_index_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TARGET_INDEX_KEY&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  type_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_LOGSTASH_TYPE_NAME&#39;] || &#39;fluentd&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  include_timestamp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_INCLUDE_TIMESTAMP&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  template_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_NAME&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  template_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_FILE&#39;] || use_nil}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  template_overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_TEMPLATE_OVERWRITE&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sniffer_class_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_SNIFFER_CLASS_NAME&#39;] || &#39;Fluent::Plugin::ElasticsearchSimpleSniffer&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  request_timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_REQUEST_TIMEOUT&#39;] || &#39;5s&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  application_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_APPLICATION_NAME&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  suppress_type_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_SUPPRESS_TYPE_NAME&#39;] || &#39;true&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  enable_ilm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ENABLE_ILM&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ilm_policy_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY_ID&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ilm_policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY&#39;] || use_default}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ilm_policy_overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_ILM_POLICY_OVERWRITE&#39;] || &#39;false&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    flush_thread_count</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_THREAD_COUNT&#39;] || &#39;8&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    flush_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_INTERVAL&#39;] || &#39;5s&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    chunk_limit_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_CHUNK_LIMIT_SIZE&#39;] || &#39;16M&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    queue_limit_length</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_QUEUE_LIMIT_LENGTH&#39;] || &#39;32&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    retry_max_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#{ENV[&#39;FLUENT_ELASTICSEARCH_BUFFER_RETRY_MAX_INTERVAL&#39;] || &#39;30&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    retry_forever</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/match</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#将以上配置通过configmap写入k8s，重启fluentd</span></span></code></pre></div><h3 id="_7-登录kibana-创建index-pattern" tabindex="-1">7. 登录kibana，创建index pattern <a class="header-anchor" href="#_7-登录kibana-创建index-pattern" aria-label="Permalink to &quot;7. 登录kibana，创建index pattern&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Management -&gt; Stack Management -&gt; Kibana -&gt; Index patterns -&gt; Create index pattern</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输入k8s_uat*</span></span></code></pre></div><h3 id="_8-kibana设置" tabindex="-1">8. kibana设置 <a class="header-anchor" href="#_8-kibana设置" aria-label="Permalink to &quot;8. kibana设置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#（1）单行高度，显示更多日志原文内容 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Kibana</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Advanced</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Settings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> truncate:maxHeight:600</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#（2）默认列，设置为日志级别和日志正文，便于开发同学查看 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Kibana</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Advanced</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Settings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> defaultColumns:level,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw_log</span></span></code></pre></div><h2 id="五、生产配置" tabindex="-1">五、生产配置 <a class="header-anchor" href="#五、生产配置" aria-label="Permalink to &quot;五、生产配置&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in_tail_ltd_logs</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 只收集文件名以 ltd 开头的业务日志，但排除前端服务和 ltd-ccci-svc-qx-document（python服务，日志格式不一致）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/containers/ltd-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pos_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/log/ltd-containers.log.pos&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  exclude_path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/containers/ltd-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">front</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log,ltd-ccci-svc-qx-document</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # read_from_head true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 针对 containerd 容器运行时，使用 cri 插件解析日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cri</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 日志处理流程</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  @label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @ltd_backend</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">label @ltd_backend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 添加 kubernetes 元数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes_metadata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter_kubernetes_metadata</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 标签处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> record_modifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      app_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;container_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;namespace_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      pod_name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;pod_name&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      pod_ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;pod_ip&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      container_image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;container_image&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">record</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&#39;kubernetes&#39;][&#39;host&#39;]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      environment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prod</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    remove_keys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes,docker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 删除日志中的空行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> message</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 拼接多行日志</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> concat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> message</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stream_identity_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container_id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    multiline_start_regexp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:[^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\.\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 合并日志事件的最大间隔，确保在一定时间内，即使没有更多日志事件输入也会将已经积累的日志合并并输出；在没有足够的日志数据合并时，确保及时输出合并的日志，避免因等待其他日志而导致日志延迟</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    flush_interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # concat 插件在处理最后一行日志时，会等待更多的日志行来完成拼接，但没有新的日志行到达，导致处理最后一行日志超时; 将最后一行日志直接投递到ES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    timeout_label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @TIMEOUT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> concat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> message</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #表示日志流字段，fluentd通过该字段来正确分组和合并日志，container_id根据每个容器id来分组和合并日志事件，适用于容器化环境</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stream_identity_key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container_id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    multiline_start_regexp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /^Creating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SqlSession/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    flush_interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # concat 插件在处理最后一行日志时，会等待更多的日志行来完成拼接，但没有新的日志行到达，导致处理最后一行日志超时; 将最后一行日志直接投递到ES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    timeout_label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @TIMEOUT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 投递日志到ES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out_es</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @log_level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    include_tag_key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    hosts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.53.142.14,10.53.142.15,10.53.142.16</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9200</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ssl_verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    reconnect_on_error</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    logstash_format</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    logstash_prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ylt_prod_k8s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    logstash_dateformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %Y.%m.%d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log_es_400_reason</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flush_thread_count</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flush_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      chunk_limit_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16M</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      queue_limit_length</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      retry_max_interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      retry_forever</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 超时处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">label @TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out_es_timeout</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @log_level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    include_tag_key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    hosts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.53.142.14,10.53.142.15,10.53.142.16</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9200</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ssl_verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    reconnect_on_error</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    logstash_format</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    logstash_prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ylt_prod_k8s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    logstash_dateformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %Y.%m.%d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log_es_400_reason</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flush_thread_count</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flush_interval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      chunk_limit_size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16M</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      queue_limit_length</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      retry_max_interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      retry_forever</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link prev" href="/ops/DevOps/Deploy/Mysql%208.4.2%20%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Previous page</span><span class="title" data-v-d4a0bba5>6. MySQL8.4.2-主从-部署文档</span><!--]--></a></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/ops/DevOps/Deploy/kibana-%E8%AE%BE%E7%BD%AEes%E7%B4%A2%E5%BC%95%E8%BF%87%E6%9C%9F.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>8. kibana-设置es索引过期</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"devops_deploy_index.md\":\"B0q9nLLe\",\"devops_kubernetes_【k8s-故障排查-01】-故障-排查思路汇总.md\":\"D3fMNgmD\",\"devops_kubernetes_【k8s-集群证书-01】-kubeadm-证书更新.md\":\"C2jhRu1u\",\"devops_deploy_kibana-设置es索引过期.md\":\"DI9nV6Tz\",\"devops_mysql_index.md\":\"isehDFWl\",\"devops_kubernetes_【k8s-故障排查-02】-故障-calico启动失败.md\":\"D1Kcv54n\",\"api-examples.md\":\"D1lSbE-n\",\"markdown-examples.md\":\"DGKJNemY\",\"devops_mysql_vastbase外部数据.md\":\"Dh0RbLRQ\",\"devops_linux_index.md\":\"DJm_wxJa\",\"devops_linux_【linux-磁盘扩容-01】-lvm逻辑卷管理.md\":\"B-Hkx_4P\",\"devops_mysql_mysql8.4设置密码规则.md\":\"CqxXLqN6\",\"devops_kubernetes_【k8s-集群证书-02】-kubelet-证书轮换失败处理.md\":\"vjCBSKYB\",\"devops_network_tcp端口转发-rinetd.md\":\"DbE1EzhT\",\"devops_kubernetes_index.md\":\"DFzsFcJP\",\"devops_network_index.md\":\"DJen84k-\",\"devops_network_安全扫描工具-clamav.md\":\"CTNJvluL\",\"devops_mysql_vastbase-zcbus同步.md\":\"_zuBWGu-\",\"devops_deploy_rocketmq 5.2.0 部署文档.md\":\"DdBH-IZ3\",\"index.md\":\"boEUd5PG\",\"devops_deploy_文件实时同步部署文档.md\":\"C6ZshSeZ\",\"devops_kubernetes_【k8s-存储-01】-configmap.md\":\"BFnVVZXi\",\"devops_mysql_vastbase时钟同步.md\":\"fwgpMtDV\",\"devops_deploy_seata v2.1.0 部署文档.md\":\"BUV2VgTW\",\"devops_deploy_mysql 8.4.2 主从同步部署文档.md\":\"DrSZ2mlC\",\"devops_deploy_minio部署文档.md\":\"BALsuiB6\",\"devops_linux_linux常用命令记录.md\":\"C7ubCBON\",\"devops_mysql_vastbase常用操作.md\":\"CpwNUGY-\",\"devops_kubernetes_【k8s-部署安装-01】-v1.28.2-部署文档.md\":\"DpVRH1vF\",\"devops_deploy_fluentd-k8s部署文档.md\":\"BJUNZt2p\",\"devops_deploy_发布平台部署文档.md\":\"kGY2MS7r\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"LTSK-运维知识库\",\"description\":\"关注运维技术\",\"base\":\"/ops/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"Kubernetes\",\"link\":\"/DevOps/Kubernetes/index.md\"},{\"text\":\"Linux\",\"link\":\"/DevOps/Linux/index.md\"},{\"text\":\"部署\",\"link\":\"/DevOps/Deploy/index.md\"},{\"text\":\"数据库\",\"link\":\"/DevOps/MySQL/index.md\"},{\"text\":\"网络\",\"link\":\"/DevOps/Network/index.md\"}],\"sidebar\":{\"/DevOps/Kubernetes/\":[{\"text\":\"部署安装\",\"collapsed\":true,\"items\":[{\"text\":\"1. K8S-V1.28.2-部署文档\",\"link\":\"/DevOps/Kubernetes/【K8S-部署安装-01】-V1.28.2-部署文档\"}]},{\"text\":\"集群证书\",\"collapsed\":true,\"items\":[{\"text\":\"1. K8S-集群-证书更新\",\"link\":\"/DevOps/Kubernetes/【K8S-集群证书-01】-kubeadm-证书更新\"},{\"text\":\"2. K8S-集群-客户端证书\",\"link\":\"/DevOps/Kubernetes/【K8S-集群证书-02】-kubelet-证书轮换失败处理\"}]},{\"text\":\"集群存储\",\"collapsed\":true,\"items\":[{\"text\":\"1. K8S-存储-ConfigMap\",\"link\":\"/DevOps/Kubernetes/【K8S-存储-01】-ConfigMap\"},{\"text\":\"2. K8S-存储-Secret\",\"link\":\"/DevOps/Kubernetes/【K8S-存储-02】-Secret\"}]},{\"text\":\"日常运维\",\"collapsed\":true,\"items\":[{\"text\":\"1. K8S-V1.28.2-部署文档\",\"link\":\"/DevOps/Kubernetes/【K8S-部署安装-01】-V1.28.2-部署文档\"}]},{\"text\":\"故障排查\",\"collapsed\":true,\"items\":[{\"text\":\"1. K8S-故障-排查思路\",\"link\":\"/DevOps/Kubernetes/【K8S-故障排查-01】-故障-排查思路汇总\"},{\"text\":\"2. K8S-故障-calico启动失败\",\"link\":\"/DevOps/Kubernetes/【K8S-故障排查-02】-故障-Calico启动失败\"}]}],\"/DevOps/Deploy/\":[{\"items\":[{\"text\":\"0. 云链通配置信息\",\"link\":\"/DevOps/Deploy/云链通项目配置信息\"},{\"text\":\"1. RocketMQ-V5.2.0-部署文档\",\"link\":\"/DevOps/Deploy/RocketMQ 5.2.0 部署文档\"},{\"text\":\"2. Minio-部署文档\",\"link\":\"/DevOps/Deploy/Minio部署文档\"},{\"text\":\"3. Seata-V2.1.0-部署文档\",\"link\":\"/DevOps/Deploy/Seata v2.1.0 部署文档\"},{\"text\":\"4. ylt发布平台-部署文档\",\"link\":\"/DevOps/Deploy/发布平台部署文档\"},{\"text\":\"5. rsync+inotify-部署文档\",\"link\":\"/DevOps/Deploy/文件实时同步部署文档\"},{\"text\":\"6. MySQL8.4.2-主从-部署文档\",\"link\":\"/DevOps/Deploy/Mysql 8.4.2 主从同步部署文档\"},{\"text\":\"7. fluentd-k8s-部署文档\",\"link\":\"/DevOps/Deploy/fluentd-k8s部署文档\"},{\"text\":\"8. kibana-设置es索引过期\",\"link\":\"/DevOps/Deploy/kibana-设置es索引过期\"}]}],\"/DevOps/MySQL/\":[{\"items\":[{\"text\":\"1. vastbase-日常运维\",\"link\":\"/DevOps/MySQL/vastbase常用操作\"},{\"text\":\"2. vastbase-时钟同步\",\"link\":\"/DevOps/MySQL/vastbase时钟同步\"},{\"text\":\"3. vastbase-数据调用\",\"link\":\"/DevOps/MySQL/vastbase外部数据\"},{\"text\":\"4. vastbase-zcbus同步\",\"link\":\"/DevOps/MySQL/vastbase-zcbus同步\"},{\"text\":\"5. mysql8.4-设置密码规则\",\"link\":\"/DevOps/MySQL/mysql8.4设置密码规则\"}]}],\"/DevOps/Linux/\":[{\"items\":[{\"text\":\"Linux-工作常用命令\",\"link\":\"/DevOps/Linux/Linux常用命令记录\"},{\"text\":\"LVM-逻辑卷管理\",\"link\":\"/DevOps/Linux/【Linux-磁盘扩容-01】-LVM逻辑卷管理\"}]}],\"/DevOps/Network/\":[{\"items\":[{\"text\":\"网络运维信息-LTSK\",\"link\":\"/DevOps/Network/网络运维信息-龙腾数科\"},{\"text\":\"网络知识记录\",\"link\":\"/DevOps/Network/网络知识记录\"},{\"text\":\"TCP端口转发-rinetd\",\"link\":\"/DevOps/Network/TCP端口转发-rinetd\"},{\"text\":\"安全扫描工具-clamav\",\"link\":\"/DevOps/Network/安全扫描工具-clamav\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>